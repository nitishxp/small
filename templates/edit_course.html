{% extends "website/_base.html" %} {% block main_content %}
{% load filter %}
<div class="x_content">
    <div class="form_wizard wizard_verticle">
        <ul class="list-unstyled wizard_steps anchor">
            <li>
                <a href="#course_info" class="selected timeline">
                    <span class="step_no">Course Info</span>
                </a>
            </li>
            <li>
                <a href="#student_enrollment" class="selected timeline student_enrollment">
                    <span class="step_no">Enrollment</span>
                </a>
            </li>
            <li>
                <a href="#student_grouping" class="selected timeline student_grouping">
                    <span class="step_no">Grouping</span>
                </a>
            </li>
            <li>
                <a href="#all_grades" class="selected timeline">
                    <span class="step_no">All Grades</span>
                </a>
            </li>
            <li>
                <a href="#peer_grades" class="selected timeline">
                    <span class="step_no">Peer Grades</span>
                </a>
            </li>
	{% comment %}
            <li>
                <a data-toggle="modal" data-target="#custom_grouping" class="selected timeline">
                    <span class="step_no">Custom Grouping</span>
                </a>
            </li>
	{% endcomment %}
        </ul>
        <div class="stepContainer">
            <div id="course_info" class="content" style="display: none">
                <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2> Create Course </h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <form method="POST" class="form-horizontal form-label-left">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="course_id">Course Id:
                                            <span class="required">*</span>
                                        </label>
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <input type="text" id="course_id" name="course_id" value="{{ course.course_id }}" class="form-control col-md-7 col-xs-12" required>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="course_name">Course Name:
                                            <span class="required">*</span>
                                        </label>
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <input type="text" id="course_name" name="course_name" value="{{ course.course_name }}" class="form-control col-md-7 col-xs-12" required>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="grading_rubric">Grading Policy
                                        </label>
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <textarea name="grading_rubric" class="form-control col-md-7 col-xs-12" required id="grading_rubric" rows="15">{{ course.grading_rubric }}</textarea>
                                        </div>
                                    </div>
                                    <div class="form-group" style="display: none;">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="appeal_role">Explain the appeal role
                                        </label>
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <textarea name="appeal_role" class="form-control col-md-7 col-xs-12" required id="appeal_role" rows="15">{{ course.appeal_role }}</textarea>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="course_grading_type">Grading Type
                                        </label>
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <select name="course_grading_type" class="form-control col-md-7 col-xs-12" required id="course_grading_type">
                                                <option value="N" {% if course.course_grading_type == "N" %}  selected {% endif %} >Number</option>
                                                <option value="A" {% if course.course_grading_type == "A" %}  selected {% endif %}>Alphabet</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="course_group_type">Group Type
                                        </label>
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <select name="course_group_type" class="form-control col-md-7 col-xs-12" required id="course_group_type">
                                                <option value="same" {% if course.course_group_type == "same" %}  selected {% endif %}>Keep the Same</option>
                                                <option value="shuffle" {% if course.course_group_type == "shuffle" %}  selected {% endif %} >Shuffle</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group" style="display: none;">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="course_function">Function
                                        </label>
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <select name="course_function" class="form-control col-md-7 col-xs-12" required id="course_function">
                                                <option value="g" {% if course.course_function == "g" %}  selected {% endif %} >Only Grouping</option>
                                                <option value="p" {% if course.course_function == "p" %}  selected {% endif %}>Peer Evalutation</option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label class="control-label col-md-4 col-sm-3 col-xs-12" for="appeal_role">
                                        </label>
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <input type="button" value="Add Assignments" class="btn btn-primary" id="add_assignments">
                                        </div>
                                    </div>
                                    <table class="homework_assignment table table-border">
                                        {% for c in homework %}
                                        <tr>
                                            <td colspan="5">
                                                <label> Assignment {{ c.homework_name }} Title </label>
                                                <input type="text" name="{{ c.homework_name }}___assignment_title" value="{{ c.assignment_title }}"
                                                    class="form-control" required>
                                            </td>
                                        </tr>
                                        <tr class='assign_cl'>
                                            <td>
                                                <label> Assignment {{ c.homework_name }} Deadline </label>
                                                <br>
                                                <input type="text" name="{{ c.homework_name }}___homework_deadline" value="{{ c.homework_deadline|date:'m/d/Y H:i A' }}"
                                                    class="form-control datepicker" required>
                                            </td>
                                            <td>
                                                <label> Grading Deadline </label>
                                                <br>
                                                <input type="text" name="{{ c.homework_name }}___grade_deadline" value="{{ c.grade_deadline|date:'m/d/Y H:i A' }}" class="form-control datepicker"
                                                    required>
                                            </td>
                                            <td>
                                                <input type="hidden" name="{{ c.homework_name }}___constraints" value="random" required>
                                            </td>
                                            <td>
                                                <label>No. of Students Per Group</label>
                                                <br>
                                                <input type="number" min="1" name="{{ c.homework_name }}___no_of_group" value="{{c.no_of_group}}" class="form-control" required>
                                            </td>
                                            <td>
                                                <label>No. Of Graders</label>
                                                <br>
                                                <select name="{{ c.homework_name }}___no_of_grader" value="{{c.no_of_grader}}" class="form-control" required>
                                                    <option {% if c.no_of_grader == '1' %} selected {% endif %} value="1">1</option>
                                                    <option {% if c.no_of_grader == '2' %} selected {% endif %} value="2">2</option>
                                                    <option {% if c.no_of_grader == '3' %} selected {% endif %} value="3">3</option>
                                                    <option {% if c.no_of_grader == '4' %} selected {% endif %} value="4">4</option>
                                                    <option {% if c.no_of_grader == '5' %} selected {% endif %} value="5">5</option>
                                                    <option {% if c.no_of_grader == '6' %} selected {% endif %} value="6">6</option>
                                                    <option {% if c.no_of_grader == '7' %} selected {% endif %} value="7">7</option>
                                                    <option {% if c.no_of_grader == '8' %} selected {% endif %} value="8">8</option>
                                                    <option {% if c.no_of_grader == '9' %} selected {% endif %} value="9">9</option>
                                                    <option {% if c.no_of_grader == '10' %} selected {% endif %} value="10">10</option>
                                                    <option {% if c.no_of_grader == 'all' %} selected {% endif %} value="all">All</option>
                                                </select>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td colspan="5">
                                                <label>Grading Rubric</label><br>
                                                <textarea name="{{ c.homework_name }}___grade_rubric"  class="form-control" rows="5" required> {{ c.grade_rubric}} </textarea>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </table>
                                    <div class="form-group">
                                        <div class="col-md-4 col-sm-3 col-xs-12"></div>
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <input type="submit" value="Submit" class="btn btn-primary">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- <div id="student_upload" class="content" style="display: none">
                <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        
                    </div>
                </div>
            </div>  -->
            <div id="student_enrollment" class="content" style="display: none">
                <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2> Student Upload </h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <form action="{% url 'instructor__student_upload' course_pk %}" method="POST" enctype="multipart/form-data" class="form-horizontal form-label-left">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="course_id">Upload Student Csv
                                        </label>
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <input type="file" accept=".csv" class="form-control col-md-7 col-xs-12" required="True" name="student_upload">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-4 col-sm-3 col-xs-12"></div>
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <input type="submit" value="Upload" class="btn btn-primary">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="x_panel">
                            <div class="x_title">
                                <h2> TA </h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <form action="{% url 'instructor__ta_assign' course_pk %}" method="POST" enctype="multipart/form-data" class="form-horizontal form-label-left">
                                    {% csrf_token %}
                                    <div class="form-group">
                                        <label class="control-label col-md-3 col-sm-3 col-xs-12" for="course_id">Enter Email
                                        </label>
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <input type="email" class="form-control col-md-7 col-xs-12" required="True" name="email" value="{{ ta.user.username }}">
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <div class="col-md-4 col-sm-3 col-xs-12"></div>
                                        <div class="col-md-6 col-sm-6 col-xs-12">
                                            <input type="submit" value="Share Authorization" class="btn btn-primary">
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                        <div class="x_panel">
                            <div class="x_title">
                                <h2> Course Student </h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <table class="table" id="student_enrollment_list">
                                    <thead>
                                        <tr>
                                        <th> Student Name</th>
                                        <th>Enrollment Status</th>
                                        <th> Action </th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                        {% for c in enrolled_student %}
                                        <tr>
                                            <td>{{ c.user.name }}</td>
                                            <td>
                                                <input type="checkbox" value="{{ c.user.id }}" {% if c.enrollment_status %} checked {% endif %}>
                                            </td>
                                            <td> <input type="button" value="Delete" class="delete_btn" data-user="{{ c.user.id }}">  </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="student_grouping" class="content" style="display: none">
                <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2>
                                    Groups
                                </h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <div class="" role="tabpanel" data-example-id="togglable-tabs">
                                    <ul id="myTab" class="nav nav-tabs bar_tabs">
                                        {% for k,v in group_grades.items %}
                                        <li>
                                            <a href="#assignment{{k}}" id="home-tab" role="tab" data-toggle="tab" aria-expanded="true">{{v.title}}</a>
                                        </li>
                                        {% endfor %}
                                    </ul>
                                    <div id="myTabContent" class="tab-content">
                                        {% for key , values in group_grades.items %}
                                        <div role="tabpanel" class="tab-pane fade" id="assignment{{key}}" aria-labelledby="home-tab">
                                            <table class="table table-border nowrap" id="table{{key}}" style="width:100%">
                                                <thead>
                                                    <th>ID</th>
                                                    <th>Group</th>
                                                    <th>Grader</th>
                                                    <th>Grade</th>
                                                    <th>Explanation</th>
                                                    <th>HW Download</th>
                                                    <th>Appeal Grader</th>
                                                    <th>Appeal Grade</th>
                                                    <th>Appeal Explanation</th>
                                                    <th>Override Grade</th>
                                                    <th>Instructor Comments</th>
                                                </thead>
                                                <tbody>
                                                    {% for v in values.value %}
                                                    <tr>
                                                        <td><input type="text" class="form-control group_id_edit" style="width: 100px" value="{{ v.group_id }}" readonly="true" data-group="{{ v.id }}" data-value="{{ v.group_id }}"></td>
                                                        <td>{{ v.group|linebreaks }}</td>
                                                        <td>{{ v.grader|linebreaks }}</td>
                                                        <td>
                                                            {{ v.grade|linebreaks }}
                                                        </td>
                                                        {% if v.deadline_miss %}
                                                            <td>
                                                                <span style="color: red">Late Submission</span>
                                                                <br>
                                                                {% if v.updated_at %}
                                                                    {{ v.updated_at }}
                                                                {% else %}
                                                                    No Time Available
                                                                {% endif %}

                                                            </td>
                                                        {% else %}
                                                            <td>{{ v.explanation|linebreaks }}</td>
                                                        {% endif %}

                                                        {% if v.file is None or v.file == "None" %}
                                                                <td> </td>
                                                            {% else %}
                                                                <td><a href="{{v.file}}"> Download </a></td>
                                                        {% endif %}

                                                        <td>{{ v.appeal_grader|linebreaks }}</td>
                                                        <td>{{ v.appeal_grade }}</td>
                                                        <td>{{ v.appeal_explanation.strip }}</td>
                                                        <td>
                                                            <select class="form-control instructor_override" data-group="{{ v.id }}" data-default-value="{{ v.instructor_grade }}" >
                                                                <option value="" {% if v.instructor_grade is None or v.instructor_grade == '' %} selected {% endif %} > Select {{v.instructor_grade}} </option>
                                                                <option value="A"  {% if v.instructor_grade == "A" %}   selected {% endif %}> A</option>
                                                                <option value="A-" {% if v.instructor_grade == "A-" %}  selected {% endif %}> A-</option>
                                                                <option value="B+" {% if v.instructor_grade == "B+" %}  selected {% endif %}> B+</option>
                                                                <option value="B"  {% if v.instructor_grade == "B" %}   selected {% endif %}> B</option>
                                                                <option value="B-" {% if v.instructor_grade == "B-" %}  selected {% endif %}> B-</option>
                                                                <option value="C+" {% if v.instructor_grade == "C+" %}  selected {% endif %}> C+</option>
                                                                <option value="C"  {% if v.instructor_grade == "C" %}   selected {% endif %}> C</option>
                                                                <option value="C-" {% if v.instructor_grade == "C-" %}  selected {% endif %}> C-</option>
                                                                <option value="D+" {% if v.instructor_grade == "D+" %}  selected {% endif %}> D+</option>
                                                                <option value="D"  {% if v.instructor_grade == "D" %}   selected {% endif %}> D</option>
                                                                <option value="D-" {% if v.instructor_grade == "D-" %}  selected {% endif %}> D-</option>
                                                                <option value="F"  {% if v.instructor_grade == "F" %}   selected {% endif %}> F</option>
                                                            </select>
                                                        </td>
                                                        <td>
                                                            <textarea class="instructor_override_explanation" data-group="{{ v.id }}" data-default-value="{{ v.instructor_comment.strip }}">{{ v.instructor_comment.strip }}</textarea>
                                                        </td>
                                                    </tr>
                                                    {% endfor %}
                                                </tbody>
                                            </table>
                                        </div>
                                        {% endfor %}
                                    </div>
                                </div>
                            </div>
                            <div class="x_title">
                                <h2> Student Grouping </h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <div class="row">
                                    <div class="col-md-3">
                                    </div>
                                    <div class="col-md-3">
                                        <form action="{% url 'instructor__do_grouping' course_pk %}" method="POST">
                                            {% csrf_token %}
                                            <div class="form-group">
                                                <div class="col-md-4 col-sm-3 col-xs-12"></div>
                                                <div class="col-md-6 col-sm-6 col-xs-12">
                                                    <input type="submit" value="Do Grouping" class="btn btn-primary">
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="col-md-3">
                                        <form action="{% url 'instructor__re_grouping' course_pk %}" method="POST" onsubmit="return validate(this)">
                                            {% csrf_token %}
                                            <div class="form-group">
                                                <div class="col-md-4 col-sm-3 col-xs-12"></div>
                                                <div class="col-md-6 col-sm-6 col-xs-12">
                                                    <input type="submit" value="Redo Grouping" class="btn btn-primary">
                                                </div>
                                            </div>
                                        </form>
                                    </div>
                                    <div class="col-md-3">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="all_grades" class="content" style="display: none">
                <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2> All Grades </h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <table id="group_all_grade" class="table">
                                    <thead>
                                        <th> Name</th>
                                        {% for c in homework %}
                                        <th>HW {{ c.homework_name }}</th>
                                        {% endfor %}
                                        <th> Total</th>
                                    </thead>
                                    <tbody>
                                        {% for key,values in all_grades.items %}
                                        <tr>
                                            <td>{{ values.name }}</td>
                                            {% for grade in values.grade %}
                                                {% if course.course_grading_type == "A" %}
                                                    <td> {{ grade|grade_alphabet }}</td>
                                                {% else %}
                                                    <td> {{ grade|grade_number }}</td>
                                                {% endif %}
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div id="peer_grades" class="content" style="display: none">
                <div class="row">
                    <div class="col-md-12 col-sm-12 col-xs-12">
                        <div class="x_panel">
                            <div class="x_title">
                                <h2> Peer Grades </h2>
                                <div class="clearfix"></div>
                            </div>
                            <div class="x_content">
                                <table id="first_grade_grading" class="table">
                                    <thead>
                                        <th> Name</th>
                                        {% for c in homework %}
                                        <th>HW {{ c.homework_name }} Grading quality</th>
                                        {% endfor %}
                                        <th> Total</th>
                                    </thead>
                                    <tbody>
                                        {% for key,values in first_grader_grading.items %}
                                        <tr>
                                            <td>{{ values.name }}</td>
                                            {% for grade in values.grade %}
                                                {% if course.course_grading_type == "A" %}
                                                    <td> {{ grade|grade_alphabet }}</td>
                                                {% else %}
                                                    <td> {{ grade|grade_number }}</td>
                                                {% endif %}
                                            {% endfor %}
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
 <div class="modal fade" id="custom_grouping" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <form  method="post" action="{% url 'instructor__custom_grouping_new' course_pk %}">
                {% csrf_token %}
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <label>No Of Groups</label>
                            <input type="text" id="no_of_groups_custom" class="form-control" readonly="true">
                        </div>
                        <div class="col-md-6">
                            <label>Assignment</label>
                            <input type="text" id="custom_grouping_assignment" class="form-control" readonly="true">
                            <input type="hidden" id="custom_grouping_assignment_id" name="assignment_id">
                        </div>
                    </div>
                    <hr>
                        <table class="table" id="custom_grouping_table">
                            <thead>
                                <tr>
                                    <th>Group</th>
                                    <th>Name</th>
                                    <!-- <th> User Id</th> -->
                                </tr>
                            </thead>
                            <tbody>
                                {% for c in enrolled_student %}
                                <tr>
                                    <td>
                                        <select class="id_custom form-control" name="custom_group_student__{{c.user.id}}" data-value="{{c.user.id}}">
                                            <option></option>
                                        </select>
                                    </td>
                                    <td>{{ c.user.name }}</td>
                                    <!-- <td> {{ c.user.id }} </td> -->
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                </div>
                <br/>
                <br/>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    <input type="submit" class="btn btn-primary" value="Save changes" >
                </div>
            </form>
        </div>
    </div>
</div>
<script>
    $('body').on('focus',".datepicker", function() {
        $(this).datetimepicker({
            format: 'MM/DD/YYYY HH:mm A',
            inline : true,
            sideBySide: true
        });
    });

    $(document).on('ready', function () {

        $('#group_all_grade').DataTable({
            buttons: [
                'copy', 'csv', 'excel', 'pdf', 'print'
            ],
            bRetrieve: true,
            dom: "Bfrtip",
        });

        {% for key , values in group_grades.items %}
            try {
                var datatable{{key}} = $('#table{{key}}').DataTable({
             "aoColumnDefs": [{ "bVisible": false, "aTargets": [] }],

                buttons: [
                     'csv', 'pdf', 'print',{
                        text: 'Download Homework',
                        action: function ( e, dt, node, config ) {
                            window.location = 'download_all_homework/{{ key }}/'
                        }
                    },
                    {
                        text: 'Custom Grouping',
                        action: function ( e, dt, node, config ) {
                            console.log("Populating Option");
                            $.ajax({
                                url : "fetch_homework_group_members/{{ key }}/",
                                success: function(result){

                                    // set the no_of_group
                                    var group_names = result.group_names
                                    var assignment_name = result.assignment_title
                                    var assignment_id = result.assignment_id

                                    $("#custom_grouping_assignment").val(assignment_name)
                                    $("#no_of_groups_custom").val(group_names.length)
                                    $("#custom_grouping_assignment_id").val(assignment_id)
                                    var option = "";
                                    if (group_names < 1){
                                        return false
                                    }
                                    console.log("Populating Option");

                                    for (let i = 0 ; i < group_names.length ; i++ ){
                                        option += '<option value="'+group_names[i]+'">'+group_names[i]+'</option>';
                                    }

                                    $(".id_custom").each( function () {
                                        $(this).html(option);
                                    });

                                    console.log(result);
                                    for (let c in result.members){
                                        // c is the group id
                                        for (let u in result.members[c]){
                                            userId = result.members[c][u];
                                            var sel = '[name="custom_group_student__'+userId+'"] option[value="'+c+'"]';
                                            console.log(sel);
                                            $(sel).attr("selected", "selected");
                                        }
                                        console.log(c,result.members[c])
                                    }

                                    // show the modal
                                    // $('#custom_grouping_table').DataTable({
                                    //     buttons: [],
                                    //     bRetrieve: true,
                                    //     dom: "Bfrtip",
                                    //     fndestroy: true
                                    // });

                                    $("#custom_grouping").modal('show')
                                }
                            })
                        }
                    }
                ],
                bRetrieve: true,
                dom: "Bfrtip",
                bScrollCollapse : true,
            });
            }catch(e){
                console.log(e)
            }
        {% endfor %}

        // saving the instructor comments
        setInterval(function(){ 
            $('.instructor_override_explanation').each(function(){
                var element = this
                let odata = $(this).attr('data-default-value').trim();
                let id = $(this).data('group');
                let explanation = $(this).val().trim();
                if (odata != explanation) {           
                    console.log(odata, explanation, odata==explanation);
                    $.ajax({
                        url : "override/",
                        method : 'POST',
                        data : {'explanation':explanation,'id':id },
                        success : function (result) {
                                console.log("Setting value",explanation);
                                $(element).attr('data-default-value',explanation);
                            }
                        })
                    }
                });
        },2000);

        $(document).on("change",".instructor_override",function () {
            if (!confirm("Are you sure you want to edit")){
                $(this).val($(this).data('default-value'));
                return false;   
            }
            let id = $(this).data('group');
            let grade = $(this).val();
            var element = this
            $.ajax({
                url : "override/",
                method : 'POST',
                data : {'grade':grade,'id':id },
                success : function (result) {
                    alert('Updated');
                    $(element).attr('data-default-value',grade);
                    // $(element).find('option').each(function(){
                    //     console.log($(this).val(),grade)
                    //     if($(this).val() == grade){
                    //         console.log("Selecting");
                    //         $(this).attr('selected','selected');
                    //     }
                    // })
                }
            })
        });

        $('#student_enrollment_list').DataTable({
            buttons: [
                'copy', 'csv', 'excel', 'pdf', 'print'
            ],
            bRetrieve: true,
            dom: "Bfrtip",
        });

        $('#first_grade_grading').DataTable({
            buttons: [
                'copy', 'csv', 'excel', 'pdf', 'print'
            ],
            bRetrieve: true,
            dom: "Bfrtip",
        });


        $(document).on('click',"input[type='checkbox']", function(){
	        a = $(this).is(":checked");
            $.ajax({
                    url : "enroll/",
                    method : 'POST',
                    data : {'userId':$(this).val(),'status':a},
                    success: function(result){
                        alert('Status Changed');
                    }
            })
        });


        $(document).on('click',".delete_btn", function(){
            var user = $(this).data("user");
            var tr = this;
            $.ajax({
                    url : "delete_student/",
                    method : 'POST',
                    data : {'userId': user },
                    success: function(result){
                       $(tr).closest('tr').hide();
                       alert('Deleted');
                    }
            })
        });
        var first_tab = $("#myTab").find('li')[0];
        if (first_tab){
            console.log("Clicking Tab");
            $('#myTab li a:first').tab('show');
        }
    });

    function validate(form) {
        return confirm('Are you sure you want to redo grouping?');
    }

    // group edit
    $(".group_id_edit").on('click',function(){
        $('.group_id_edit').attr('readonly',true);
        $(this).attr('readonly',false);
    })

    setInterval(function(){ 
            $('.group_id_edit').each(function(){
                var element = this
                let odata = $(this).attr('data-value').trim();
                let id = $(this).data('group');
                let newData = $(this).val().trim();
                if (odata != newData) {           
                    console.log(odata, newData, odata==newData);
                    $.ajax({
                        url : "override_group_name/",
                        method : 'POST',
                        data : {'name':newData,'id':id },
                        success : function (result) {
                                console.log("Setting value",newData);
                                $(element).attr('data-value',newData);
                            }
                    })
                }
            });
    },2000);

</script> {% endblock %}
